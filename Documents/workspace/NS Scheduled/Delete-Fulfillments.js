/**
 * Module Description
 * 
 * Version    Date            Author           Remarks
 * 1.00       18 Jan 2015     anthony.carter
 *
 */

/**
 * @param {String} type Context Types: scheduled, ondemand, userinterface, aborted, skipped
 * @returns {Void}
 */
function scheduled(type) {
	
	var deploy = nlapiGetContext().getDeploymentId();
	var usage;
	
	
	var scriptParams = nlapiGetContext().getSetting('SCRIPT', 'custscript_therecs');
	if (deploy && deploy == 'customdeploy1') {
		
		if (scriptParams && scriptParams != '') {
			var fulfills = JSON.parse(scriptParams);
		} else {
			var fulfills = fulfills1;
		}
		processTheRecs(fulfills);
	} else if (deploy && deploy == 'customdeploy2') {
		
		if (scriptParams && scriptParams != '') {
			var fulfills = JSON.parse(scriptParams);
		} else {
			var fulfills = fulfills2;
		}
		processTheRecs(fulfills);
	} else if (deploy && deploy == 'customdeploy3') {
		

		if (scriptParams && scriptParams != '') {
			var fulfills = JSON.parse(scriptParams);
		} else {
			var fulfills = fulfills3;
		}
		
		processTheRecs(fulfills);
	} else if (deploy && deploy == 'customdeploy4') {
		
		if (scriptParams && scriptParams != '') {
			var fulfills = JSON.parse(scriptParams);
		} else {
			var fulfills = fulfills4;
		}
		
		processTheRecs(fulfills);
	} else if (deploy && deploy == 'customdeploy5') {
		if (scriptParams && scriptParams != '') {
			var fulfills = JSON.parse(scriptParams);
		} else {
			var fulfills = fulfills5;
		}
		processTheRecs(fulfills);
	}
	
}

function processTheRecs(fulfills) {
	var theLength = fulfills.length;
	for (var i=0; i< theLength; i++) {
		
		var usage = nlapiGetContext().getRemainingUsage();
		
		if (usage && usage < 40) {
			var context = nlapiGetContext();
			var jsonIDs = JSON.stringify(fulfills);
			
			var scriptStatus = nlapiScheduleScript(context.getScriptId(),context.getDeploymentId(), {custscript_therecs: jsonIDs});
			if (scriptStatus == 'QUEUED') {
				break;
			}
		} else {
			//Util.console.log(fulfills[i], 'id');
			Util.console.log(i, 'i');
			Util.console.log(theLength, 'theLength');
			try {
				
				nlapiDeleteRecord('vendorbill', fulfills[i]);
				
				//var fulfillRec = nlapiLoadRecord('itemreceipt', fulfills[i]);
				
				//fulfillRec.setFieldValue('custbody_consol_fx_rate', '.74');
				//nlapiSubmitRecord(fulfillRec);
				//fulfills = fulfills.splice(1, theLength);
				Util.console.log('remaining usage = ' + usage);
			} catch(e) {
				Util.console.log(e.message, 'error');
				continue;
			}
			
			
			
		}
		
		
		
	}
}


var fulfills1 = ['1415884'];

var fulfills2 = ['975833', '982041', '982045', '982049', '982053', '982057', '982061', '982065', '982069', '982073', '982077', '982081', '1041328', '1041332', '1041336', '1076081', '1076084', '1076086', '1076191', '1076293', '1168080', '1183511', '1183521', '1183531', '1183542', '1183552', '1183559', '1183566', '1183575', '1183585', '1183594', '1183604', '1198785', '1200593', '1202539', '1202541', '1202543', '1210154', '1306342', '1309500', '1309502', '1309648', '1114462', '1168172', '1168176', '1168192', '1168196', '1168200', '1168204', '1168208', '1168212', '1168214', '1168218', '1113164', '1113270', '1113374', '1113378', '1113583', '1113787', '1113791', '1113795', '1113797', '1113799', '1113801', '1113903', '1113905', '1113907', '1113909', '1113911', '1113913', '1113915', '1113917', '1113919', '1113921', '1113923', '1113925', '1113927', '1113931', '1114035', '1114139', '1114141', '1114145', '1114147', '1114153', '1114157', '1114567', '1118614', '1118616', '1168234', '1168238', '1168242', '1168246', '1168250', '1168254', '1168256', '1168260', '1168264', '1168268', '1168273', '1168277', '1168281', '1168285', '1168289', '1168293', '1168297', '1168301', '1168305', '1168309', '1168313', '1168317', '1168321', '1168325', '1168329', '1168333', '1168337', '1168341', '1168345', '1168349', '1168353', '1168357', '1168361', '1168365', '1168369', '1168373', '1168377', '1168473', '1168477', '1168481', '1168483', '1168487', '1168491', '1168495', '1168499', '1168503', '1168507', '1168511', '1168515', '1168519', '1168523', '1168527', '1168533', '1168537', '1168541', '1168549', '1168553', '1183933', '1183937', '1214275', '1214279', '1214283', '1214287', '1214289', '1214293', '1214297', '1240586', '1240588', '1309363', '1309389', '1309393', '1123066', '1123170', '1123274', '1123276', '1123278', '1123280', '1123282', '1123284', '1123488', '1123490', '1123604', '1123606', '1123608', '1123817', '1123819', '1123821', '1123925', '1123927', '1127855', '1128063', '1128168', '1128170', '1128374', '1128376', '1128481', '1128483', '1128588', '1128593', '1128697', '1128699', '1128704', '1128706', '1128813', '1128815', '1128919', '1129023', '1129025', '1129130', '1129236', '1129238', '1129292'];

var fulfills3 = ['1129416', '1129537', '1129554', '1129660', '1129766', '1129872', '1130093', '1130197', '1172404', '1202608', '1208380', '1208382', '1208384', '1208386', '1208388', '1208390', '1208392', '1208394', '1208396', '1231751', '1231753', '1231755', '1232960', '1302149', '1302156', '1302160', '1302163', '1302168', '1302170', '1302173', '1302175', '1302179', '1302182', '1302190', '1302192', '1302194', '1302196', '1302199', '1302203', '1302205', '1302207', '1302210', '1302212', '1302216', '1302218', '1302223', '1302225', '1302231', '1302233', '1302235', '1302237', '1302239', '1302346', '1302348', '1302350', '1302352', '1302354', '1302356', '1302358', '1306110', '1306350', '1306352', '1306459', '1306570', '1306675', '1306783', '1306785', '1307020', '1307022', '1307238', '1307456', '1307560', '1307664', '1307772', '1307880', '1307984', '1307988', '1308092', '1308102', '1308109', '1308126', '1308361', '1308363', '1308365', '1308367', '1308369', '1308371', '1308373', '1308375', '1308377', '1308483', '1308587', '1308802', '1308804', '1308806', '1308810', '1308824', '1308826', '1308828', '1308835', '1308958', '1308964', '1309172', '1309377', '1309379', '1309381', '1309385', '1309387', '1309491', '1309495', '1309600', '1309604', '1309608', '1309612', '1309617', '1309621', '1309623', '1309625', '1309627', '1309629', '1309634', '1309638', '1309642', '1309644'];

var fulfills4 = ['1376967', '1376968', '1376969', '1376970', '1376971', '1376972', '1376973', '1376974', '1376975', '1376976', '1376977', '1376978', '1376979', '1376980', '1376981', '1376982', '1376983', '1376984', '1376985', '1376986', '1376987', '1376988', '1376989', '1376990', '1376991', '1376992', '1376993', '1376994', '1376995', '1376996', '1376997', '1376998', '1376999', '1377000', '1377001', '1377002', '1377003', '1377004', '1377005', '1377006', '1377007', '1377008', '1377009', '1377010', '1377011', '1377012', '1377013', '1377014', '1377015', '1377016', '1377017', '1377018', '1377019', '1377020', '1377021', '1377022', '1377023', '1377024', '1377025', '1377028', '1377029', '1377030', '1377031', '1377032', '1377033', '1377034', '1377035', '1377036', '1377037', '1377038', '1377039', '1377040', '1377041', '1377042', '1377043', '1377044', '1377045', '1377046', '1377047', '1377048', '1377049', '1377050', '1377051', '1377052', '1377053', '1377054', '1377055', '1377056', '1377057', '1377058', '1377059', '1377060', '1377061', '1377062', '1377063', '1377064', '1377065', '1377066', '1377067', '1377068', '1377069', '1377070', '1377071', '1377072', '1377073', '1377074', '1377075', '1377076', '1377077', '1377078', '1377079', '1377080', '1377081', '1377082', '1377083', '1377084', '1377085', '1377086', '1377087', '1377088', '1377089', '1377090', '1377091', '1377092', '1377093', '1377094', '1377095', '1377096', '1377097', '1377098', '1377099', '1377100', '1377101', '1377102', '1377103', '1377104', '1377105', '1377106', '1377107', '1377108', '1377109', '1377661', '1377662', '1377663', '1377664', '1377665', '1377666', '1377667', '1377668', '1377669', '1377670', '1377671', '1377672', '1377673', '1377674', '1377675', '1377676', '1377677', '1377678', '1377679', '1377680', '1377681', '1377682', '1377683', '1377684', '1377685', '1377686', '1377687', '1379675', '1379676', '1379677', '1379678', '1379679', '1379680', '1379681', '1379682', '1379683'];

var fulfills5 = ['1370434', '1370435', '1370436', '1370437', '1370438', '1370439', '1370440', '1370441', '1370442', '1370443', '1370444', '1370445', '1370446', '1370447', '1370448', '1370449', '1370450', '1370451', '1370452', '1370453', '1370454', '1370455', '1370456', '1370457', '1370458', '1370459', '1370460', '1370461', '1370462', '1370463', '1370464', '1370465', '1370466', '1370467', '1370468', '1370469', '1370470', '1370471', '1370472', '1370473', '1370474', '1370475', '1370476', '1370477', '1370478', '1370479', '1370480', '1370481', '1370482', '1370483', '1370484', '1370485', '1370486', '1370487', '1370488', '1370489', '1370490', '1370491', '1370492', '1370493', '1370494', '1370495', '1370496', '1370497', '1370498', '1370499', '1370500', '1370501', '1370502', '1376977', '1376978', '1376979', '1376980', '1376981', '1376982', '1376983', '1376984', '1376985', '1376986', '1376987', '1376988', '1376989', '1376990', '1376991', '1376992', '1376993', '1376994', '1376995', '1376996', '1376997', '1376998', '1376999', '1377000', '1377001', '1377002', '1377003', '1377004', '1377005', '1377006', '1377007', '1377008', '1377009', '1377010', '1377011', '1377012', '1377013', '1377014', '1377015', '1377016', '1377017', '1377018', '1377019', '1377020', '1377021', '1377022', '1377023', '1377024', '1377025', '1377028', '1377029', '1377030', '1377031', '1377032', '1377033', '1377034', '1377035', '1377036', '1377037', '1377038', '1377039', '1377040', '1377041', '1377042', '1377043', '1377044', '1377045', '1377046', '1377047', '1377048', '1377049', '1377050', '1377051', '1377052', '1377053', '1377054', '1377055', '1377056', '1377057', '1377058', '1377059', '1377060', '1377061', '1377062', '1377063', '1377064', '1377065', '1377066', '1377067', '1377068', '1377069', '1377070', '1377071', '1377072', '1377073', '1377074', '1377075', '1377076', '1377077', '1377078', '1377079', '1377080', '1377081', '1377082', '1377083', '1377084', '1377085', '1377086', '1377087', '1377088', '1377089', '1377090', '1377091', '1377092', '1377093', '1377094', '1377095', '1377096', '1377097', '1377098', '1377099', '1377100', '1377101', '1377102', '1377103', '1377104', '1377105', '1377106', '1377107', '1377108', '1377109', '1377661', '1377662', '1377663', '1377664', '1377665', '1377666', '1377667', '1377668', '1377669', '1377670', '1377671', '1377672', '1377673', '1377674', '1377675', '1377676', '1377677', '1377678', '1377679', '1377680', '1377681', '1377682', '1377683', '1377684', '1377685', '1377686', '1377687', '1379675', '1379676', '1379677', '1379678', '1379679', '1379680', '1379681', '1379682', '1379683'];